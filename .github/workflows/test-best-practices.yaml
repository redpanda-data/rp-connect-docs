name: Test Best Practices Examples

on:
  push:
    branches: [main]
    paths:
      - 'modules/ai-agents/examples/best-practices/**/*.yaml'
      - 'modules/ai-agents/examples/best-practices/test-best-practices.sh'
      - 'modules/ai-agents/partials/mcp/*.adoc'
  pull_request:
    branches: [main]
    paths:
      - 'modules/ai-agents/examples/best-practices/**/*.yaml'
      - 'modules/ai-agents/examples/best-practices/test-best-practices.sh'
      - 'modules/ai-agents/partials/mcp/*.adoc'

jobs:
  lint-and-test:
    name: Lint and Test All Best Practices Examples
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: npm install

      - name: Install tools
        run: |
          npx doc-tools install-test-dependencies
          rpk connect install

      - name: Make test script executable
        run: |
          chmod +x modules/ai-agents/examples/best-practices/test-best-practices.sh

      - name: Run pipeline tests
        run: |
          cd modules/ai-agents/examples/best-practices
          ./test-best-practices.sh

  test-matrix:
    name: Test Examples by Category
    runs-on: ubuntu-latest
    strategy:
      matrix:
        category: [input-validation, response-formatting, error-handling]
      fail-fast: false

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: npm install

      - name: Install tools
        run: |
          npx doc-tools install-test-dependencies
          rpk connect install

      - name: Make test script executable
        run: chmod +x modules/ai-agents/examples/best-practices/test-best-practices.sh

      - name: Test ${{ matrix.category }} examples
        run: |
          cd modules/ai-agents/examples/best-practices
          ./test-best-practices.sh ${{ matrix.category }}
