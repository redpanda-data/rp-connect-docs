// Single-sourced partial for tool implementation best practices
// Used in Connect best-practices.adoc and Cloud best-practices.adoc
//
// Include from Connect: include::ai-agents:partial$mcp/tool-implementation-practices.adoc[]
// Include from Cloud: include::redpanda-connect:ai-agents:partial$mcp/tool-implementation-practices.adoc[]

=== Keep tools focused

Each tool should do one thing well. If you find yourself adding multiple unrelated operations, split them into separate tools.

Tools that do too much or have vague purposes cause problems because AI clients rely on descriptions to choose tools. Vague descriptions lead to wrong tool selection. Tools that do too much are harder to test and debug. Broad tools often have implicit assumptions that aren't documented.

.Good: Single responsibility
[source,yaml]
----
include::example$best-practices/tool-implementation/single-responsibility.yaml[tags=good-user-profile]
----

[source,yaml]
----
include::example$best-practices/tool-implementation/single-responsibility.yaml[tags=good-user-settings]
----

.Bad: Multiple responsibilities
[source,yaml]
----
include::example$best-practices/tool-implementation/single-responsibility.yaml[tags=bad-manage-user]
----

Write descriptions that clearly state what the tool does, what input it needs, and what it returns. If a tool is doing multiple things, split it into focused tools.

=== Use environment variables for secrets

ifdef::env-cloud[]
All credentials and sensitive values must be stored in the Redpanda Cloud xref:develop:connect/configuration/secret-management.adoc[Secrets Store]. Reference secrets as `${secrets.NAME}` in your YAML configuration.
endif::[]
ifndef::env-cloud[]
Never hardcode API keys or credentials. Secrets in code can be accidentally committed to version control, anyone with access to the files can see the credentials, and rotating secrets requires changing code.
endif::[]

[source,yaml]
----
include::example$best-practices/tool-implementation/secrets-handling.yaml[tags=correct-vs-wrong,indent=0]
----

=== Design for quick completion

MCP tools should complete quickly. AI clients wait for responses, and long-running tools cause poor user experiences.

Tools that wait indefinitely, poll continuously, or never return cause problems because MCP tools use a request/response model. A tool that never completes will time out and fail, and resources remain allocated while waiting.

Follow these guidelines:

ifdef::env-cloud[]
* Set explicit timeouts on all external calls. See xref:develop:connect/components/processors/http.adoc[`http` processor] for timeout options.
endif::[]
ifndef::env-cloud[]
* Set explicit timeouts on all external calls. See xref:components:processors/http.adoc[`http` processor] for timeout options.
endif::[]
* Avoid unbounded reads. Read N messages, not all messages.
* Consider pagination for large datasets.
* Return partial results if full processing takes too long.
* If processing is slow, consider async patterns.

[[one-file-one-component-type]]
=== One file per component type

Each YAML file must contain exactly one component type. Do not build MCP tools as if they were continuous pipelines with inputs, processors, and outputs in a single file.

[source,yaml]
----
include::example$best-practices/tool-implementation/component-type.yaml[tags=wrong-pipeline]
----

Including separate top-level sections for different component types causes the MCP server to fail because it cannot determine which component is the tool. The lint command will fail with `unable to infer component type`.

If your logic requires multiple components, split them into separate files and let the AI client orchestrate them, or use an output tool with processors.

Also avoid adding wrapper blocks like `input:` or `output:` when defining component files:

[source,yaml]
----
include::example$best-practices/tool-implementation/component-type.yaml[tags=wrong-wrapper]
----

[source,yaml]
----
include::example$best-practices/tool-implementation/component-type.yaml[tags=correct-component]
----

=== Check component support levels

Before using a component in production, check its support level and license requirements:

* Community components may lack support and stability guarantees.
* Enterprise components require a valid license.
* Production incidents caused by unsupported components are harder to resolve.

ifdef::env-cloud[]
See xref:develop:connect/components/about.adoc[Components overview] for support levels and licensing information.
endif::[]
ifndef::env-cloud[]
See xref:components:about.adoc[Components overview] for support levels and licensing information.
endif::[]

Prefer certified components for production tools. Test with your license to verify components work. Document any licensing assumptions in your tool descriptions.
