// =============================================================================
// PARTIAL: debugging-techniques.adoc
// =============================================================================
//
// INCLUDED BY:
//   - rp-connect-docs: modules/ai-agents/pages/mcp-server/troubleshooting.adoc
//   - cloud-docs: modules/ai-agents/pages/mcp/remote/troubleshooting.adoc
//
// INCLUDE SYNTAX:
//   Connect: include::ai-agents:partial$mcp/troubleshooting/debugging-techniques.adoc[]
//   Cloud:   include::redpanda-connect:ai-agents:partial$mcp/troubleshooting/debugging-techniques.adoc[]
//
// ATTRIBUTES USED:
//   - env-cloud: Switches xref targets and testing instructions for Cloud context
//
// DEPENDENCIES:
//   None
// =============================================================================

=== Add temporary logging

ifdef::env-cloud[]
Insert xref:develop:connect/components/processors/log.adoc[`log` processors] to debug data flow:
endif::[]
ifndef::env-cloud[]
Insert xref:components:processors/log.adoc[`log` processors] to debug data flow:
endif::[]

[source,yaml]
----
processors:
  - log:
      message: "Input received: ${! json() }"
      level: DEBUG
  - # ... your processing logic ...
  - log:
      message: "Output produced: ${! json() }"
      level: DEBUG
----

ifdef::env-cloud[]
The `${! json() }` syntax uses xref:develop:connect/guides/bloblang/functions.adoc#json[Bloblang interpolation] to insert the current message content.
endif::[]
ifndef::env-cloud[]
The `${! json() }` syntax uses xref:guides:bloblang/functions.adoc#json[Bloblang interpolation] to insert the current message content.
endif::[]

Remove debug processors before deploying to production.

=== Test your tools

Build confidence by testing at each stage:

ifdef::env-cloud[]
. Lint your configuration using the *Lint* button in the Cloud Console.
. Test tool logic using the *MCP Inspector*.
. Connect to your AI client using `rpk cloud mcp proxy`.
. Test end-to-end with realistic prompts.
endif::[]
ifndef::env-cloud[]
. Lint your configuration with `rpk connect mcp-server lint`.
. Start the server and test with cURL or an MCP client.
. Connect to your AI client and verify the tool appears.
. Test end-to-end with realistic prompts.

For the complete testing workflow with cURL scripts, see xref:ai-agents:mcp-server/create-tool.adoc#_test_the_tool[Test the tool].
endif::[]

=== Isolate the problem

When debugging complex tools:

. Test each processor individually by commenting out others.
. Use static test data instead of live API calls.
. Check if the issue is in input validation, processing logic, or output formatting.
. Compare working tools with broken ones to identify differences.
