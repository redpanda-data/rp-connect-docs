// This content is autogenerated. Do not edit manually.

== Examples

=== Use GPT-4o analyze an image

This example fetches image URLs from stdin and has GPT-4o describe the image.

[source,yaml]
----
input:
  stdin:
    scanner:
      lines: {}
pipeline:
  processors:
    - http:
        verb: GET
        url: "${!content().string()}"
    - openai_chat_completion:
        model: gpt-4o
        api_key: TODO
        prompt: "Describe the following image"
        image: "root = content()"
output:
  stdout:
    codec: lines
----

=== Provide historical chat history

This pipeline provides a historical chat history to GPT-4o using a cache.

[source,yaml]
----
input:
  stdin:
    scanner:
      lines: {}
pipeline:
  processors:
    - mapping: |
        root.prompt = content().string()
    - branch:
        processors:
          - cache:
              resource: mem
              operator: get
              key: history
          - catch:
            - mapping: 'root = []'
        result_map: 'root.history = this'
    - branch:
        processors:
        - openai_chat_completion:
            model: gpt-4o
            api_key: TODO
            prompt: "${!this.prompt}"
            history: 'root = this.history'
        result_map: 'root.response = content().string()'
    - mutation: |
        root.history = this.history.concat([
          {"role": "user", "content": this.prompt},
          {"role": "assistant", "content": this.response},
        ])
    - cache:
        resource: mem
        operator: set
        key: history
        value: '${!this.history}'
    - mapping: |
        root = this.response
output:
  stdout:
    codec: lines

cache_resources:
  - label: mem 
    memory: {}
----

=== Use GPT-4o to call a tool

This example asks GPT-4o to respond with the weather by invoking an HTTP processor to get the forecast.

[source,yaml]
----
input:
  generate:
    count: 1
    mapping: |
      root = "What is the weather like in Chicago?"
pipeline:
  processors:
    - openai_chat_completion:
        model: gpt-4o
        api_key: "${OPENAI_API_KEY}"
        prompt: "${!content().string()}"
        tools:
          - name: GetWeather
            description: "Retrieve the weather for a specific city"
            parameters:
              required: ["city"]
              properties:
                city:
                  type: string
                  description: the city to look up the weather for
            processors:
              - http:
                  verb: GET
                  url: 'https://wttr.in/${!this.city}?T'
                  headers:
                    User-Agent: curl/8.11.1 # Returns a text string from the weather website
output:
  stdout: {}
----


