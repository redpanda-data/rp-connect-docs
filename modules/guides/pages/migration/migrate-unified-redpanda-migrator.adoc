= Migrate to Unified Redpanda Migrator
:description: Learn how to move from legacy migrator components to the unified redpanda_migrator input/output pair in Redpanda Connect 4.67.0+.

This guide explains how to migrate from legacy migrator components (`redpanda_migrator_bundle`, `redpanda_migrator`, `redpanda_migrator_offsets`, `schema_registry`) to the unified `redpanda_migrator` input/output pair. The unified migrator simplifies configuration by consolidating all migration logic into a single output component.

== At a glance

* **Available:** Redpanda Connect 4.67.0+
* **Legacy migrator components status:** Deprecated in 4.67.0
* **Breaking change:** Not backward-compatible with legacy components. You must update your configuration to use it.
* One input and one output only. No bundle wrapper
* All migration behavior controlled by the output component
* Components paired by matching `label` fields
* Source Schema Registry: `input.redpanda_migrator.schema_registry`
* Destination Schema Registry: `output.redpanda_migrator.schema_registry`
* Consumer group migration: `output.redpanda_migrator.consumer_groups`
* Topic mapping: `output.redpanda_migrator.topic` with interpolation (replaces `topic_prefix`)

== Architectural changes

The fundamental change is the move from a complex, multi-component system to a simple, coordinated pair:

**Legacy Architecture**:: Complex wrapper component (`redpanda_migrator_bundle`) that internally managed three separate component pairs: `redpanda_migrator` for data, `schema_registry` for schemas, and `redpanda_migrator_offsets` for consumer group offsets. Required complex internal routing and sequencing.

**Unified Architecture**:: Single `redpanda_migrator` input/output pair. The input acts as a simple Kafka consumer for the source cluster. All migration logic, including topic creation, schema synchronization, and consumer group offset translation, is handled by the output component.

Benefits of the new design:

* **Simplified Configuration**: All migration settings in one place (the output)
* **Improved Coordination**: Direct input/output pairing removes complex internal routing
* **Enhanced Features**: Fine-grained control over topic and schema synchronization and improved ACL handling

== Migration checklist

[%interactive]
* [ ] Back up existing configurations before making changes.
* [ ] Add new `input.redpanda_migrator` and `output.redpanda_migrator` with matching labels.
* [ ] Move source Kafka and Schema Registry settings to the `input.redpanda_migrator` component.
* [ ] Move destination Kafka and Schema Registry settings to the `output.redpanda_migrator` component.
* [ ] Replace `topic_prefix` with `topic`.
* [ ] Move offset settings to `output.redpanda_migrator.consumer_groups`.
* [ ] Remove deprecated fields.
* [ ] Validate configuration with `rpk connect lint`.
* [ ] Test on non-production topics first.
* [ ] Monitor migration progress and performance.
* [ ] Remove legacy configuration after successful migration.

== Field mapping reference

The following tables detail field mappings for each legacy component:

=== Bundle wrapper fields

The `redpanda_migrator_bundle` wrapper fields map to the new structure as follows:

.Input: `redpanda_migrator_bundle` field mapping
[width="100%",options="header"]
|===
| Legacy Field | New Location | Status | Notes

| `redpanda_migrator` (object)
| `input.redpanda_migrator`
| **Moved**
| Container moved to new input component

| `schema_registry` (object)
| `input.redpanda_migrator.schema_registry`
| **Moved**
| Source schema registry configuration

| `migrate_schemas_before_data`
| -
| **Removed**
| Behavior managed by `output.redpanda_migrator.schema_registry.interval`

| `consumer_group_offsets_poll_interval`
| `output.redpanda_migrator.consumer_groups.interval`
| **Moved**
| Now controls offset sync frequency
|===

.Output: `redpanda_migrator_bundle` field mapping
[width="100%",options="header"]
|===
| Legacy Field | New Location | Status | Notes

| `redpanda_migrator` (object)
| `output.redpanda_migrator`
| **Moved**
| Destination Kafka cluster configuration

| `schema_registry` (object)
| `output.redpanda_migrator.schema_registry`
| **Moved**
| Destination schema registry configuration

| `translate_schema_ids`
| `output.redpanda_migrator.schema_registry.translate_ids`
| **Moved**
| Schema ID translation flag

| `input_bundle_label`
| `label` on input/output
| **Replaced**
| Components paired using matching labels
|===

=== Data migration fields

.Input: `redpanda_migrator` field mapping
[width="100%",options="header"]
|===
| Legacy Field | New Location | Status | Notes
| All fields (`*`) | `input.redpanda_migrator.*` | **Moved** | Direct mapping to new input
|===

.Output: `redpanda_migrator` field mapping
[width="100%",options="header"]
|===
| Legacy Field | New Location | Status | Complexity

| Connection settings^1^
| `output.redpanda_migrator.*`
| **Moved**
| 游릭 Direct mapping

| Producer settings^2^
| `output.redpanda_migrator.*`
| **Moved**
| 游릭 Direct mapping

| `translate_schema_ids`
| `output.redpanda_migrator.schema_registry.translate_ids`
| **Moved**
| 游릭 Direct mapping

| `topic_prefix`
| `output.redpanda_migrator.topic`
| **Replaced**
| 游댰 Requires interpolation syntax to replicate `topic_prefix` behavior

| `replication_factor_override`, `replication_factor`
| `output.redpanda_migrator.topic_replication_factor`
| **Replaced**
| 游릭 Unified field

| `schema_registry_output_resource`
| `output.redpanda_migrator.schema_registry.*`
| **Replaced**
| 游댰 Configure inline

| `input_resource`
| `label` on input/output
| **Replaced**
| 游릭 Matching labels

| Message routing^3^
| -
| **Removed**
| 游릭 Automatic behavior
|===

^1^ Connection settings: `seed_brokers`, `client_id`, `tls`, `sasl`, `metadata_max_age`, `request_timeout_overhead`, `conn_idle_timeout`

^2^ Producer settings: `idempotent_write`, `compression`, `timeout`, `max_message_bytes`, `broker_write_max_bytes`

^3^ Message routing: `max_in_flight`, `key`, `partition`, `partitioner`, `timestamp_ms`, `metadata.*`, `allow_auto_topic_creation`

=== Schema migration fields

.Input: `schema_registry` field mapping
[width="100%",options="header"]
|===
| Legacy Field | New Location | Status | Notes

| Connection^1^
| `input.redpanda_migrator.schema_registry.*`
| **Moved**
| Source schema registry connection

| `subject_filter`
| `output.redpanda_migrator.schema_registry.include`, `exclude`
| **Replaced**
| Use regex lists for filtering

| `include_deleted`
| `output.redpanda_migrator.schema_registry.include_deleted`
| **Moved**
| Configured on destination

| `fetch_in_order`
| -
| **Removed**
| Automatic dependency resolution

| `auto_replay_nacks`
| -
| **Removed**
| No longer applicable
|===

^1^ Connection fields: `url`, `tls`, `oauth`, `basic_auth`, `jwt`

.Output: `schema_registry` field mapping
[width="100%",options="header"]
|===
| Legacy Field | New Location | Status | Notes

| Connection fields
| `output.redpanda_migrator.schema_registry.*`
| **Moved**
| Destination schema registry connection

| `translate_ids`
| `output.redpanda_migrator.schema_registry.translate_ids`
| **Moved**
| Schema ID translation control

| `subject`
| `output.redpanda_migrator.schema_registry.subject`
| **Moved**
| Subject naming configuration

| `normalize`
| `output.redpanda_migrator.schema_registry.normalize`
| **Moved**
| Schema normalization

| `subject_compatibility_level`
| -
| **Replaced**
| Propagated from source when set

| `backfill_dependencies`
| `output.redpanda_migrator.schema_registry.versions`
| **Replaced**
| Choose `all` or `latest`

| Parallelism^1^
| -
| **Removed**
| Handled by unified design
|===

^1^ Parallelism fields: `max_in_flight`, `input_resource`

=== Consumer group offset migration

The entire `redpanda_migrator_offsets` input/output pair is replaced by the `consumer_groups` block in the new output.

.`redpanda_migrator_offsets` field mapping
[width="100%",options="header"]
|===
| Legacy Component | New Location | Status | Notes

| Input: All fields
| `output.redpanda_migrator.consumer_groups`
| **Replaced**
| Uses same source connection as main input

| Output: All fields
| `output.redpanda_migrator.consumer_groups`
| **Replaced**
| Uses same destination connection as main output
|===

== Migration example

The following example demonstrates a complete migration from legacy to unified components.

[.side-by-side]
--
.Legacy configuration
[source,yaml]
----
input:
  label: "source_cluster"
  redpanda_migrator_bundle:
    redpanda_migrator:
      seed_brokers: [ "source-kafka:9092" ]
      topics: [ "orders", "payments" ]
      consumer_group: "migration_group"
    schema_registry:
      url: "http://source-registry:8081"
    migrate_schemas_before_data: false
    consumer_group_offsets_poll_interval: 30s

output:
  redpanda_migrator_bundle:
    redpanda_migrator:
      seed_brokers: [ "destination-redpanda:9092" ]
      topic_prefix: "migrated_"
    schema_registry:
      url: "http://destination-registry:8081"
    translate_schema_ids: true
    input_bundle_label: "source_cluster"
----

.Unified configuration
[source,yaml]
----
input:
  label: "migration_pipeline" # <1>
  redpanda_migrator:
    # Source Kafka settings
    seed_brokers: [ "source-kafka:9092" ]
    topics: [ "orders", "payments" ]
    consumer_group: "migration_group"

    # Source Schema Registry settings
    schema_registry:
      url: "http://source-registry:8081"

output:
  label: "migration_pipeline" # <2>
  redpanda_migrator:
    # Destination Redpanda settings
    seed_brokers: [ "destination-redpanda:9092" ]

    # Topic mapping (replaces topic_prefix)
    topic: 'migrated_${! @kafka_topic }' # <3>

    # Destination Schema Registry and migration settings
    schema_registry:
      url: "http://destination-registry:8081"
      translate_ids: true
      # Rename subjects
      subject: 'migrated_${! metadata("schema_registry_subject") }'

    # Consumer group migration settings
    consumer_groups:
      enabled: true
      interval: 30s # <4>
      exclude: [ "migration_group" ] # <5>
----

<1> Labels are now used for pairing input and output.
<2> Matching label pairs the input and output components.
<3> Use xref:configuration:interpolation.adoc[interpolation] syntax to replicate `topic_prefix` behavior.
<4> Replaces `consumer_group_offsets_poll_interval`.
<5> Exclude the migrator's own consumer group.

--

== Validation

Always validate your configuration before running:

[source,bash]
----
rpk connect lint config.yaml
----

== Troubleshooting

=== Labels don't match

Ensure input and output have identical `label` values. Labels are case-sensitive.

=== Topic interpolation errors

Verify interpolation syntax: `topic: 'prefix_${! @kafka_topic }'`

Common mistakes:

* Missing `!` in interpolation: `${@kafka_topic}`
* Incorrect variable name: `${!kafka_topic}`
* Missing quotes: `topic: prefix_${! @kafka_topic }`

=== Schema registry connection issues

Check that source schema registry is configured in `input.redpanda_migrator.schema_registry` and destination in `output.redpanda_migrator.schema_registry`.

=== Consumer group migration not working

Ensure `consumer_groups.enabled: true` is set in the output configuration.

=== Testing recommendations

. **Start small**: Test with a single topic before migrating all data
. **Monitor logs**: Watch for error messages during migration
. **Verify data**: Compare source and destination topic contents
. **Check offsets**: Verify consumer group offsets are correctly translated
. **Validate schemas**: Ensure all schemas are properly migrated

== Quick reference

[cols="2,3"]
|===
| Legacy | Unified

| `redpanda_migrator_bundle`
| `redpanda_migrator` input + output pair

| `input_bundle_label`
| Matching `label` fields

| `topic_prefix: "new_"`
| `topic: 'new_${! @kafka_topic }'`

| `translate_schema_ids`
| `schema_registry.translate_ids`

| `consumer_group_offsets_poll_interval`
| `consumer_groups.interval`

|===

== Next steps

After successful migration:

- Remove legacy configuration files.
- Update documentation and runbooks.
- Train team members on the new configuration format.

For advanced configuration options, see the xref:components:outputs/redpanda_migrator.adoc[redpanda_migrator output] reference documentation.